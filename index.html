<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Controle de Movimento do Aeroporto - Importa√ß√£o Local</title>
<style>
  /* RESET & BASE */
  *, *::before, *::after { box-sizing: border-box; }
  body {
    margin:0; padding:0;
    font-family: 'Poppins', sans-serif;
    background: #ffffff;
    color: #6b7280;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    transition: background-color 0.4s ease, color 0.4s ease;
  }
  body.dark {
    background: #1f2937;
    color: #d1d5db;
  }
  /* HEADER */
  header#app-header {
    position: sticky; top:0; z-index:10000;
    padding: 1.5rem 2rem;
    background: #fff;
    color: #111827;
    font-weight: 800;
    font-size: 2rem;
    letter-spacing: 0.05em;
    display: flex;
    align-items: center;
    user-select: none;
    transition: background-color 0.4s ease, color 0.4s ease;
  }
  body.dark header#app-header {
    background: #374151;
    color: #f3f4f6;
  }
  #logo { color: #3b82f6; user-select: text; }
  #header-title { flex:1; margin-left:1rem; font-weight:700; font-size:2.25rem; user-select: text; color: inherit; }
  #header-actions {
    display: flex; align-items: center; gap: 1.5rem;
    font-weight: 600; font-size: 1.2rem; color: #6b7280;
  }
  body.dark #header-actions { color: #d1d5db; }
  #current-time { min-width:120px; user-select:none; }
  button#theme-toggle {
    background: none; border: none;
    font-size: 1.75rem;
    cursor: pointer;
    color: currentColor;
    transition: color 0.3s ease;
  }
  button#theme-toggle:hover { color: #2563eb; }

  /* MAIN STRUCTURE */
  #app-container {
    flex: 1; max-width: 1200px; margin: 2rem auto 3rem;
    background: #fff;
    border-radius: 0.75rem;
    box-shadow: 0 8px 24px rgb(0 0 0 / 0.08);
    display: flex;
    overflow: hidden;
    user-select: none;
    min-height: calc(100vh - 111px);
    transition: background-color 0.4s ease, color 0.4s ease;
  }
  body.dark #app-container { background: #111827; color: #d1d5db; }

  /* TERMINAL TABS */
  #terminal-tabs {
    display: flex;
    background: #f9fafb;
    border-bottom: 3px solid #e5e7eb;
    user-select: none;
  }
  body.dark #terminal-tabs { background: #374151; border-color: #4b5563; }
  #terminal-tabs button {
    flex: 1;
    padding: 1.3rem 0;
    font-weight: 700;
    font-size: 1.3rem;
    color: #6b7280;
    background: transparent;
    border: none;
    border-bottom: 4px solid transparent;
    cursor: pointer;
    user-select: none;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    transition: color 0.3s ease, border-color 0.3s ease;
    outline-offset: 4px;
  }
  #terminal-tabs button[aria-selected="true"] {
    color: #111827;
    border-bottom-color: #3b82f6;
    outline: none;
  }
  body.dark #terminal-tabs button[aria-selected="true"] {
    color: #d1d5db;
    border-bottom-color: #60a5fa;
  }
  #terminal-tabs button:hover:not([aria-selected="true"]) { color: #2563eb; }
  body.dark #terminal-tabs button:hover:not([aria-selected="true"]) { color: #93c5fd; }
  
  .tab-icon {
    stroke: currentColor;
    stroke-width: 1.8;
    width: 20px; height: 20px;
    user-select: none;
  }

  /* TERMINAL CONTENT */
  #terminal-content {
    flex: 1;
    padding: 1.5rem 1.75rem;
    background: #fefefe;
    overflow-y: auto;
    user-select: none;
    font-size: 1rem;
    display: flex;
    flex-direction: column;
    gap: 20px;
    transition: background-color 0.4s ease, color 0.4s ease;
  }
  body.dark #terminal-content { background: #1f2937; color: #d1d5db; }
  
  .positions-grid {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 1.35rem;
  }
  .position-card {
    background: #fff;
    border-radius: 0.75rem;
    box-shadow: 0 3px 14px rgb(0 0 0 / 0.07);
    padding: 1rem;
    font-weight: 700;
    color: #374151;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: box-shadow 0.35s cubic-bezier(0.4,0,0.2,1), transform 0.3s ease;
    outline-offset: 5px;
    position: relative;
  }
  body.dark .position-card {
    background: #2563eb;
    color: #e0e7ff;
    box-shadow: 0 3px 16px rgba(96, 165, 250, 0.7);
  }
  .position-card:hover, .position-card:focus-visible {
    box-shadow: 0 10px 32px rgba(59, 130, 246, 0.35);
    transform: scale(1.07);
    outline: none;
    z-index: 999;
  }
  .position-empty {
    font-style: italic;
    color: #9ca3af;
    user-select: none;
  }
  body.dark .position-empty { color: #93c5fd; }
  
  .pos-label {
    font-size: 1.15rem;
    margin-bottom: 0.45rem;
    user-select: text;
    color: inherit;
  }
  .aircraft-id {
    font-size: 1.05rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
    color: #2563eb;
    user-select: text;
  }
  body.dark .aircraft-id { color: #dbeafe; }

  /* SIDE PANEL */
  #side-panel {
    width: 360px;
    background: #fff;
    border-left: 1px solid #e5e7eb;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    user-select: none;
    transition: background-color 0.4s ease, color 0.4s ease;
    font-size: 1rem;
  }
  body.dark #side-panel {
    background: #111827;
    border-color: #4b5563;
    color: #d1d5db;
  }
  #side-panel h2 {
    font-weight: 700;
    font-size: 1.75rem;
    padding: 1rem 1.5rem 0.5rem;
    color: inherit;
    user-select: text;
  }

  /* FLIGHT TABS */
  #flight-tabs {
    display: flex;
    border-bottom: 1px solid #e5e7eb;
    user-select: none;
  }
  body.dark #flight-tabs { border-color: #4b5563; }
  #flight-tabs button {
    flex: 1;
    padding: 0.85rem 0;
    font-weight: 600;
    border: none;
    background: transparent;
    font-size: 1.25rem;
    letter-spacing: 0.03em;
    cursor: pointer;
    color: #6b7280;
    border-bottom: 3px solid transparent;
    transition: color 0.3s ease, border-color 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
  }
  #flight-tabs button[aria-selected="true"] {
    font-weight: 700;
    border-bottom-color: #3b82f6;
    color: #111827;
    outline-offset: 5px;
    outline: none;
  }
  body.dark #flight-tabs button[aria-selected="true"] {
    color: #dbeafe;
    border-bottom-color: #60a5fa;
  }
  #flight-tabs button:hover:not([aria-selected="true"]) { color: #2563eb; }
  body.dark #flight-tabs button:hover:not([aria-selected="true"]) { color: #93c5fd; }

  /* Update flights button */
  #update-flights-btn {
    margin-left: 1rem;
    background-color: #3b82f6;
    border: none;
    color: white;
    font-weight: 600;
    font-size: 1.05rem;
    padding: 0.55rem 1.3rem;
    border-radius: 0.5rem;
    cursor: pointer;
    user-select: none;
    align-self: center;
    transition: background-color 0.3s ease;
  }
  #update-flights-btn:hover,
  #update-flights-btn:focus-visible {
    background-color: #2563eb;
    outline: none;
  }
  body.dark #update-flights-btn {
    background-color: #60a5fa;
    color: #111827;
  }
  body.dark #update-flights-btn:hover,
  body.dark #update-flights-btn:focus-visible {
    background-color: #3b82f6;
  }

  /* Flight list */
  #flight-list {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 1.75rem 2rem;
    user-select: none;
  }
  .flight-card {
    background: #f9fafb;
    border-radius: 0.75rem;
    padding: 1rem 1.5rem;
    margin-bottom: 1rem;
    cursor: pointer;
    box-shadow: 0 6px 15px rgb(0 0 0 / 0.05);
    color: #374151;
    font-size: 1rem;
    user-select: text;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    outline-offset: 4px;
  }
  body.dark .flight-card {
    background: #2563eb;
    color: #e0e7ff;
    box-shadow: 0 9px 22px rgba(96, 165, 250, 0.7);
  }
  .flight-card:hover, .flight-card:focus-visible {
    background-color: #e0e7ff;
    color: #111827;
    box-shadow: 0 12px 30px rgba(59, 130, 246, 0.35);
    outline: none;
  }
  body.dark .flight-card:hover, body.dark .flight-card:focus-visible {
    background-color: #3b82f6;
    color: #fff;
    box-shadow: 0 14px 35px rgba(191, 219, 254, 0.85);
    outline: none;
  }
  .flight-header {
    display: flex;
    justify-content: space-between;
    font-weight: 700;
    color: inherit;
    font-size: 1.25rem;
    user-select: text;
  }
  .flight-info {
    margin-top: 0.35rem;
    color: #6b7280;
    font-size: 1rem;
    user-select: text;
  }
  body.dark .flight-info {
    color: #d1d5db;
  }
  .flight-status {
    margin-top: 0.5rem;
    display: inline-block;
    font-weight: 600;
    font-size: 0.9rem;
    padding: 0.25rem 0.9rem;
    border-radius: 0.5rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    user-select: none;
  }
  .status-confirmed {
    background-color: #dbeafe;
    color: #2563eb;
  }
  body.dark .status-confirmed {
    background-color: #60a5fa;
    color: #fefefe;
  }
  .status-delayed {
    background-color: #fee2e2;
    color: #b91c1c;
  }
  body.dark .status-delayed {
    background-color: #fca5a5;
    color: #630000;
  }
  .status-cancelled {
    background-color: #f3f4f6;
    color: #6b7280;
    font-style: italic;
  }
  body.dark .status-cancelled {
    background-color: #4b5563;
    color: #9ca3af;
    font-style: italic;
  }
  .flight-status-select {
    margin-top: 0.5rem;
    padding: 0.25rem 0.5rem;
    width: 100%;
    max-width: 200px;
    border-radius: 0.5rem;
    border: 1px solid #d1d5db;
    font-family: 'Poppins', sans-serif;
    font-size: 0.9rem;
    color: #111827;
    cursor: pointer;
    user-select: text;
    transition: border-color 0.3s ease;
  }
  body.dark .flight-status-select {
    border-color: #60a5fa;
    background: #1e40af;
    color: #fefefe;
  }
  .flight-status-select:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.35);
  }
  /* Modal backdrop */
  #modal-backdrop {
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    background-color: rgba(0,0,0,0.36);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    user-select: none;
    animation: fadein 0.32s ease forwards;
  }
  body.dark #modal-backdrop {
    background-color: rgba(0,0,0,0.5);
  }
  @keyframes fadein {
    from {opacity: 0;}
    to {opacity: 1;}
  }
  /* Modal content */
  #modal {
    background: #fff;
    border-radius: 0.75rem;
    max-width: 440px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    padding: 2rem 2.5rem;
    user-select: text;
    box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    gap: 1rem;
    animation: slideup 0.4s cubic-bezier(0.4,0,0.2,1) forwards;
    outline: none;
  }
  body.dark #modal {
    background: #2563eb;
    color: #fefefe;
  }
  @keyframes slideup {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }
  #modal h3 {
    font-weight: 800;
    font-size: 1.6rem;
    margin: 0 0 1rem 0;
  }
  #modal label {
    font-weight: 600;
    margin-bottom: 0.75rem;
    display: block;
  }
  #modal select, #modal input[type="time"] {
    width: 100%;
    padding: 0.6rem;
    border-radius: 0.5rem;
    border: 1px solid #d1d5db;
    font-size: 1rem;
    font-family: 'Poppins', sans-serif;
    transition: border-color 0.3s ease;
    color: #111827;
    user-select: text;
  }
  body.dark #modal select, body.dark #modal input[type="time"] {
    border-color: #60a5fa;
    background: #1e40af;
    color: #fefefe;
  }
  #modal select:focus, #modal input[type="time"]:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59,130,246,0.35);
  }
  #modal-buttons {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 1rem;
  }
  #modal-buttons button {
    background-color: #3b82f6;
    color: white;
    border: none;
    padding: 0.7rem 1.6rem;
    font-weight: 700;
    border-radius: 0.5rem;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.25s ease;
  }
  #modal-buttons button.cancel-btn {
    background-color: #9ca3af;
  }
  #modal-buttons button:hover, #modal-buttons button:focus-visible {
    background-color: #2563eb;
    outline: none;
  }
  #modal-buttons button.cancel-btn:hover, #modal-buttons button.cancel-btn:focus-visible {
    background-color: #6b7280;
    outline: none;
  }

  /* Scrollbar custom */
  #flight-list::-webkit-scrollbar, .positions-grid::-webkit-scrollbar {
    width: 7px;
  }
  #flight-list::-webkit-scrollbar-thumb, .positions-grid::-webkit-scrollbar-thumb {
    background-color: #cbd5e1;
    border-radius: 4px;
  }
  body.dark #flight-list::-webkit-scrollbar-thumb, body.dark .positions-grid::-webkit-scrollbar-thumb {
    background-color: #60a5fa;
  }

  /* Snackbar */
  #snackbar {
    visibility: hidden;
    opacity: 0;
    position: fixed;
    left: 50%;
    bottom: 2rem;
    padding: 1rem 2rem;
    background-color: #2563eb;
    color: white;
    font-size: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 6px 20px rgba(37,99,235,0.6);
    transform: translateX(-50%);
    z-index: 12000;
    transition: visibility 0.5s, opacity 0.5s;
    user-select: none;
  }
  #snackbar.show {
    visibility: visible;
    opacity: 1;
  }
  body.dark #snackbar {
    background-color: #60a5fa;
    color: #111827;
    box-shadow: 0 6px 20px rgba(96,165,250,0.9);
  }
</style>
</head>
<body>
<header id="app-header" role="banner">
  <div id="logo" aria-label="Logo do Aeroporto">‚úàÔ∏è AeroControl</div>
  <div id="header-title" aria-level="1" role="heading">Controle de Movimento do Aeroporto</div>
  <div id="header-actions" aria-live="polite" aria-atomic="true">
    <div id="current-time" aria-label="Hor√°rio local"></div>
    <button id="theme-toggle" aria-pressed="false" aria-label="Alternar tema claro e escuro" title="Alternar tema claro e escuro">üåô</button>
  </div>
</header>
<div id="app-container" role="main" aria-label="Controle de Movimento do Aeroporto">
  <div style="flex: 1; display: flex; flex-direction: column; min-width: 0;">
    <nav id="terminal-tabs" role="tablist" aria-label="Terminais do aeroporto"></nav>
    <section id="terminal-content" tabindex="0" aria-label="Posi√ß√µes do terminal"></section>
  </div>
  <aside id="side-panel" aria-label="Painel lateral de voos">
    <h2>Voos</h2>
    <nav id="flight-tabs" role="tablist" aria-label="Categorias de voos">
      <button role="tab" id="tab-arrivals" aria-controls="panel-arrivals" aria-selected="true" tabindex="0" aria-label="Mostrar voos de pouso">‚úàÔ∏è Pousos</button>
      <button role="tab" id="tab-departures" aria-controls="panel-departures" aria-selected="false" tabindex="-1" aria-label="Mostrar voos de decolagem">üõ´ Decolagens</button>
      <button id="update-flights-btn" type="button" aria-label="Atualizar lista de voos" title="Atualizar lista de voos">‚Üª Atualizar</button>
    </nav>
    <div id="side-panel-filters" aria-label="Filtros de status de voos" role="region">
      <label><input type="checkbox" name="status-filter" value="Confirmed" checked> Confirmed</label>
      <label><input type="checkbox" name="status-filter" value="Delayed" checked> Delayed</label>
      <label><input type="checkbox" name="status-filter" value="Cancelled"> Cancelled</label>
    </div>
    <div id="flight-list" role="tabpanel" aria-labelledby="tab-arrivals" tabindex="0"></div>
  </aside>
</div>
<!-- Modal -->
<div id="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <div id="modal" tabindex="-1">
    <h3 id="modal-title"></h3>
    <div id="modal-content"></div>
    <div id="modal-buttons">
      <button id="modal-confirm-btn">Confirmar</button>
      <button id="modal-cancel-btn" class="cancel-btn">Cancelar</button>
    </div>
  </div>
</div>
<!-- Snackbar -->
<div id="snackbar" role="alert" aria-live="assertive" aria-atomic="true"></div>
<script>
  'use strict';
  // Constants
  const TERMINAL_COUNT = 10;
  const POSITIONS_PER_TERMINAL = 36;
  const LANDING_RUNWAYS = ['Pista 1', 'Pista 2'];
  const DEPARTURE_RUNWAY_MAP = {
    'TPS1': 'Pista 1','TPS2': 'Pista 1','TPS3': 'Pista 1','TPS4': 'Pista 1','TPS5': 'Pista 1',
    'TPS6': 'Pista 2','TPS7': 'Pista 2','TPS8': 'Pista 2','TPS9': 'Pista 2','TPS10': 'Pista 2'
  };
  // Flight data will be loaded from the user JSON (array of flight objects)
  let flights = [];
  let currentTerminalIndex = 0;
  let currentFlightTab = 'arrivals';  // 'arrivals' or 'departures'
  let landingQueue = [];
  let lastLandingTime = 0;
  // DOM elements
  const terminalTabs = document.getElementById('terminal-tabs');
  const terminalContent = document.getElementById('terminal-content');
  const flightTabs = document.getElementById('flight-tabs');
  const flightList = document.getElementById('flight-list');
  const modalBackdrop = document.getElementById('modal-backdrop');
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modal-title');
  const modalContent = document.getElementById('modal-content');
  const modalConfirmBtn = document.getElementById('modal-confirm-btn');
  const modalCancelBtn = document.getElementById('modal-cancel-btn');
  const snackbar = document.getElementById('snackbar');
  const themeToggleBtn = document.getElementById('theme-toggle');
  const currentTimeEl = document.getElementById('current-time');
  const updateFlightsBtn = document.getElementById('update-flights-btn');
  const statusFilters = [...document.querySelectorAll('#side-panel-filters input[type=checkbox]')];
  const icons = {
    terminal: '<svg aria-hidden="true" class="tab-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20"><rect x="2" y="4" width="20" height="16" rx="2" ry="2"/><path d="M8 8h8M8 12h8M8 16h8"/></svg>'
  };
  // Snackbar function
  function showSnackbar(message) {
    snackbar.textContent = message;
    snackbar.classList.add('show');
    setTimeout(() => snackbar.classList.remove('show'), 3500);
  }
  // Create terminal tabs
  function createTerminalTabs() {
    terminalTabs.innerHTML = '';
    for(let i = 0; i < TERMINAL_COUNT; i++) {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.innerHTML = `${icons.terminal} TPS${i+1}`;
      btn.setAttribute('role', 'tab');
      btn.setAttribute('aria-selected', i === currentTerminalIndex ? 'true' : 'false');
      btn.setAttribute('tabindex', i === currentTerminalIndex ? '0' : '-1');
      btn.id = `terminal-tab-${i}`;
      btn.dataset.index = i;
      btn.addEventListener('click', () => switchTerminal(i));
      terminalTabs.appendChild(btn);
    }
  }
  // Switch terminal
  function switchTerminal(index) {
    if(index === currentTerminalIndex) return;
    const prevSelected = terminalTabs.querySelector('[aria-selected="true"]');
    if(prevSelected) {
      prevSelected.setAttribute('aria-selected', 'false');
      prevSelected.setAttribute('tabindex', '-1');
    }
    const newSelected = terminalTabs.querySelector(`[data-index="${index}"]`);
    if(newSelected) {
      newSelected.setAttribute('aria-selected', 'true');
      newSelected.setAttribute('tabindex', '0');
      newSelected.focus();
    }
    currentTerminalIndex = index;
    renderPositions();
  }
  // Render terminal positions grid
  function renderPositions() {
    const terminalId = `TPS${currentTerminalIndex + 1}`;
    terminalContent.innerHTML = '';
    const grid = document.createElement('div');
    grid.className = 'positions-grid';
    const flightsInTerminal = flights.filter(f => f.position && f.terminal === terminalId);
    for(let i=1; i<=POSITIONS_PER_TERMINAL; i++) {
      const posId = `${terminalId}-${String(i).padStart(2,'0')}`;
      const posCard = document.createElement('div');
      posCard.className = 'position-card';
      posCard.setAttribute('tabindex', '0');
      posCard.dataset.positionId = posId;
      posCard.innerHTML = `<div class="pos-label">${posId}</div>`;
      const flightOnPos = flightsInTerminal.find(f => f.position === posId);
      if(flightOnPos) {
        posCard.innerHTML += `<div class="aircraft-id">${flightOnPos.regNumber || flightOnPos.id || flightOnPos.aircraft}</div>`;
        posCard.title = `Aeronave: ${flightOnPos.aircraft}\nVoo: ${flightOnPos.number}\nStatus: ${flightOnPos.status}`;
      } else {
        posCard.classList.add('position-empty');
        posCard.innerHTML += `<div class="aircraft-id">Vazia</div>`;
        posCard.title = `Posi√ß√£o livre`;
      }
      posCard.addEventListener('click', () => { 
        if(flightOnPos) openMoveAircraftModal(flightOnPos);
        else showSnackbar('Posi√ß√£o vazia selecionada'); 
      });
      grid.appendChild(posCard);
    }
    terminalContent.appendChild(grid);
  }
  // Load flight data from GitHub raw JSON (your actual JSON contains ‚Äúchegadas‚Äù and ‚Äúpartidas‚Äù arrays)
  function loadFlightsData() {
    showSnackbar('Carregando lista de voos...');
    fetch(FLIGHTS_JSON_URL)
      .then(response => {
        if(!response.ok) throw new Error(`Erro ${response.status}`);
        return response.json();
      })
      .then(data => {
        // Your JSON structure has arrivals and departures inside "chegadas" and "partidas"
        if (!data.chegadas || !data.partidas) throw new Error('Estrutura JSON inesperada');
        // Map arrivals...
        const arrivals = data.chegadas.map(f => ({
          airline: f.companhia,
          number: f.voo,
          origin: f.cidade, 
          icao: f.icao, 
          country: f.pais,
          landingTime: parseTime(f.horario),
          aircraft: f.aeronave,
          terminal: `TPS${f.tps}`,
          type: 'landing',
          status: 'Estimated',
          position: null,
          regNumber: null,
          frequency: null,
          cancelledTimestamp: null
        }));
        // Map departures...
        const departures = data.partidas.map(f => ({
          airline: f.companhia,
          number: f.voo,
          destination: f.cidade,
          icao: f.icao,
          country: f.pais,
          departureTime: parseTime(f.horario),
          aircraft: f.aeronave,
          terminal: `TPS${f.tps}`,
          type: 'departure',
          status: 'Scheduled',
          position: f.position || null,
          regNumber: f.regNumber || null,
          frequency: null,
          cancelledTimestamp: null
        }));
        flights = [...arrivals, ...departures];
        createTerminalTabs();
        renderPositions();
        renderFlightList();
        showSnackbar('Lista de voos carregada com sucesso.');
      })
      .catch(error => {
        showSnackbar(`Falha ao carregar voos: ${error.message}`);
      });
  }
  // Helper to parse ‚ÄúHH:MM‚Äù string to Date with today‚Äôs date
  function parseTime(hmStr) {
    if (!hmStr) return null;
    const [h,m] = hmStr.split(':').map(Number);
    const now = new Date();
    const dt = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0, 0);
    return dt;
  }
  // ... (Keep your existing functions below: renderFlightList, createFlightCard, handleStatusChange, openMoveAircraftModal, etc.)
  // Due to space, you can keep your exact original implementations here, adjusted to use flights array above.
  // For example:
  // - renderFlightList filters flights by flight.type == 'landing' or 'departure' according to tab.
  // - Your existing modal and landing/takeoff management logic.
  // - Statuses and filters logic.
  // - UI interactions as before.
  // You can also adapt date comparisons for status as needed.
  // ...
  // Initialization & Event Listeners
  flightTabs.addEventListener('click', (evt) => {
    if(!evt.target.matches('button')) return;
    const selectedTab = (evt.target.id === 'tab-arrivals') ? 'arrivals' : 'departures';
    if(selectedTab === currentFlightTab) return;
    document.querySelector('#flight-tabs button[aria-selected="true"]').setAttribute('aria-selected', 'false');
    evt.target.setAttribute('aria-selected', 'true');
    currentFlightTab = selectedTab;
    setFlightListAriaLabel();
    renderFlightList();
  });
  updateFlightsBtn.addEventListener('click', loadFlightsData);
  statusFilters.forEach(filter => filter.addEventListener('change', renderFlightList));
  themeToggleBtn.addEventListener('click', () => {
    const isDark = document.body.classList.toggle('dark');
    themeToggleBtn.setAttribute('aria-pressed', isDark);
    themeToggleBtn.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
  });
  // Update clock
  function updateLocalTime() {
    const now = new Date();
    currentTimeEl.textContent = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit', second:'2-digit'});
  }
  setInterval(updateLocalTime, 1000);
  updateLocalTime();
  // FlightList aria label
  function setFlightListAriaLabel() {
    const label = currentFlightTab === 'arrivals' ? 'Lista de voos de pouso' : 'Lista de voos de decolagem';
    flightList.setAttribute('aria-label', label);
  }
  setFlightListAriaLabel();
  // Initial load
  loadFlightsData();
</script>
</body>
</html>
